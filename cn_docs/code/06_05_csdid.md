---
layout: default
title: csdid
parent: Stata代码
nav_order: 5
mathjax: true
image: "../../../assets/images/DiD.png"
---

# csdid
{: .no_toc }

## 目录
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## 说明

- 基于：[Callaway和Sant'Anna 2021](https://www.sciencedirect.com/science/article/abs/pii/S0304407620303948)
- 程序版本（如有）：v1.72
- 最后检查：2024年11月

## 安装

```stata
ssc install csdid, replace
```

查看帮助文件：

```stata
help csdid
```


## 测试命令


请确保使用[这里](https://asjadnaqvi.github.io/DiD/docs/code/06_03_data/)给出的脚本生成数据

对于`csdid`，我们需要*gvar*变量，该变量等于首次处理的值（对于处理组），对于未处理组为0：

```stata
gen gvar = first_treat
recode gvar (. = 0)
```

让我们尝试基本的`csdid`命令：

```stata
csdid Y, ivar(id) time(t) gvar(gvar) notyet
```

屏幕上会出现一个非常非常长的输出（组合爆炸）！我们可以使用事后估计选项恢复具有10个前置期和10个滞后期的事件研究：

```stata
estat event, window(-10 10) estore(cs) 
```

这将显示以下输出：

```stata
ATT by Periods Before and After treatment
Event Study:Dynamic effects
------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        Tm10 |   .3917418   .3493034     1.12   0.262    -.2928803    1.076364
         Tm9 |  -.0720548   .2991634    -0.24   0.810    -.6584043    .5142947
         Tm8 |   .0197712   .3119967     0.06   0.949    -.5917311    .6312735
         Tm7 |  -.2900224    .346774    -0.84   0.403    -.9696869    .3896422
         Tm6 |  -.1089479   .3190294    -0.34   0.733     -.734234    .5163383
         Tm5 |    .092667   .3352292     0.28   0.782    -.5643702    .7497042
         Tm4 |   .2572878   .3222909     0.80   0.425    -.3743907    .8889663
         Tm3 |   .0639963   .4214074     0.15   0.879    -.7619471    .8899396
         Tm2 |   .1944381   .3707239     0.52   0.600    -.5321673    .9210435
         Tm1 |  -.1308918   .4307277    -0.30   0.761    -.9751027     .713319
         Tp0 |  -.0608394   .3220462    -0.19   0.850    -.6920383    .5703595
         Tp1 |    8.49767   .3964781    21.43   0.000     7.720587    9.274753
         Tp2 |   17.64773   .4650298    37.95   0.000     16.73629    18.55917
         Tp3 |    25.9377   .5978201    43.39   0.000     24.76599     27.1094
         Tp4 |   34.62362   .9250424    37.43   0.000     32.81057    36.43667
         Tp5 |   42.85682   1.223002    35.04   0.000     40.45978    45.25386
         Tp6 |   51.93103   1.529193    33.96   0.000     48.93387    54.92819
         Tp7 |   60.13327   1.804358    33.33   0.000     56.59679    63.66975
         Tp8 |   68.82446   1.982765    34.71   0.000     64.93831    72.71061
         Tp9 |   77.30792   2.264938    34.13   0.000     72.86872    81.74712
        Tp10 |   85.78878    2.61102    32.86   0.000     80.67128    90.90629
------------------------------------------------------------------------------
```

为了绘制估计结果，我们可以使用`event_plot`命令（`ssc install event_plot, replace`），如下所示：


```stata
event_plot cs, default_look graph_opt(xtitle("事件发生后时期") ytitle("平均效应") ///
	标题("csdid") xlabel(-10(1)10)) stub_lag(Tp#) stub_lead(Tm#) together	 
```

我们得到以下图形：

<img src="../../../assets/images/csdid_1.png" height="300">